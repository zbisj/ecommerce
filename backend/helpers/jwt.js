// [ HELPERS > JSON WEB TOKENS] ################################################

// 1.1. EXTERNAL DEPENDENCIES ..................................................

const expressJwt = require("express-jwt");

// 1.1. END ....................................................................

// 1.2. INTERNAL DEPENDENCIES ..................................................
// 1.2. END ....................................................................

// 1.3. IMAGES .................................................................
// 1.3. END ....................................................................

// 1.4. DATA ...................................................................
// 1.4. END ....................................................................

// 1.5. MAIN ...................................................................

// 1.5.2. FUNCTIONS & LOCAL VARIABLES

function authJwt() {
  const { API_URL, SECRET } = process.env;
  return expressJwt({
    secret: SECRET,
    algorithms: ["HS256"],
    isRevoked,
  }).unless({
    path: [
      `${API_URL}/users/login`,
      `${API_URL}/users/products`,
      { url: /\/public\/uploads(.*)/, methods: ["GET", "'OPTIONS"] },
      { url: /\/api\/v1\/products(.*)/, methods: ["GET", "'OPTIONS"] },
      { url: /\/api\/v1\/categories(.*)/, methods: ["GET", "'OPTIONS"] },
    ],
  });
}

async function isRevoked(req, payload, done) {
  if (!payload.isAdmin) {
    done(null, true);
  }
  done();
}
// 1.5.2. END

// 1.5. END ....................................................................

// 1.6. STYLES .................................................................
// 1.6. END ....................................................................

module.exports = authJwt;

// END FILE ####################################################################
